<html>

<head>
    <!--  
        In the header:
          Add your css
          import data  

    -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>VA COVID-19 Contracting Data</title>
    
    
    <link rel="stylesheet" href="covid.css">
    



</head>

<body>
    

    <!--
        
       <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter2/1.5.2/crossfilter.min.js"></script>
        

-->



<script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>

<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script type="text/javascript" src="helpers.js"></script>
<script type="text/javascript" src="plots.js"></script>
<script type="text/javascript" src="data.json"></script>
<script type="text/javascript" src="states-albers-10m.json"></script>

    
    

    <!--
                <div class="navbar">
            <div class="button button-1">Office</div>
            <div class="button button-2">Product/<br>Service</div>
            <div class="button button-3">Start<br>Date</div>
            <div class="button button-4">End<br>Date</div>
        </div>


    -->
    
    

    <div class="wrapper">
        <div class="header"><h1>COVID-19 Contracting</h1></div>
        <div class="gutter left"></div>
        <div class="gutter right"></div>

        <div class = "row1">
                <div class="r1c1"></div>
                <div class="r1c2"></div>
        </div>

        

        <div class="row2">
            <div class="prose">VA's obligations peaked in late March/early April and have declined since then. 
                This is really just to show that we can intersperse text with the graphics.
            </div>
        </div>

        <div class="box3" id="box3"></div>
        <div class="row3">
            <div class="b3"></div>
        </div>
        <div class="box5">
            <div class="b5a"></div>
            <div class="b5b"></div>
        </div>

        <div class="box4" id="box4"></div>
        <div id="tooltip" class="hidden"></div>
    </div>

    <script>

        width = 750;
        height = 600;

        var margin = {top: 20, right: 10, bottom: 20, left: 20};
        w = width-margin.left-margin.right;
        h = height-margin.top-margin.bottom;

        var months = {"01": "Jan", "02": "Feb", "03": "Mar", "04": "Apr", "05": "May", "06":"Jun"};
        var mos = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

        var sortAscending = false;

        
        var ndx = crossfilter(dataSet);
        
        
        var compDim = ndx.dimension(d=>d.competed || "NA");
        var compGroup = compDim.group().reduceSum(d=>d.obligatedAmount);

        var visnDim = ndx.dimension(d=>d.contractingofficeid || "NA");
        var visnGroup = visnDim.group().reduceSum(d=>d.obligatedAmount);

        var monthDim = ndx.dimension(d => months[d.signedDate.substr(5,2)]);
        var monthGroup = monthDim.group().reduceSum(d=>d.obligatedAmount);

        var dailyDim = ndx.dimension(d => d.signedDate.substr(0,10));
        var dailyGroup = dailyDim.group().reduceSum(d=>d.obligatedAmount);

        var weeklyDim = ndx.dimension(d => getMonday(d.signedDate));
        var weeklyGroup = weeklyDim.group().reduceSum(d=>d.obligatedAmount);

        var stateDim = ndx.dimension(d => d.placeOfPerformanceState);
        var stateGroup = stateDim.group().reduceSum(d=>d.obligatedAmount);

        var dateDim = ndx.dimension(d => d.signedDate);
        var dateGroup = dateDim.group().reduceSum(d=>d.obligatedAmount);

        var pscDim = ndx.dimension(d => d.productOrServiceCode);
        var pscGroup = pscDim.group().reduceSum(d=>d.obligatedAmount);

        var vendorDim = ndx.dimension(d => d.vendorName);
        var vendorGroup = vendorDim.group().reduceSum(d=>d.obligatedAmount);


        var margin = {top: 30, right: 20, bottom: 20, left: 20};

        //tableAgPlot("#box4", deptGroup.top(10), ['Department','Obligations'], orgs);
        //barPlot("#box1", deptGroup);
        
        //plotCard('.r1c1',totalobs(),'Total Obligations');



        //var r1c1 = plotCard.bind(null, ".r1c1", totalobs(), "Total Obligations");
        //function r1c1 = plotTotalObs.bind(null);
        //var r1c2 = hbarPlot.bind(null,".r1c2",reorder(monthGroup.all(), Object.values(months)),"", monthDim);
        function r1c2() {barPlot(".r1c2", weeklyGroup.all().sort(sortWeek), "Obligations by Week", weeklyDim, {h:300})};
        //var r1c3 = pieChart.bind(null,".r1c3",compGroup.all(), compDim);
        //var box3 = bubblePlot.bind(null, "#box3",deptGroup.all());
        function box3() {plotTreemap("#box3",visnGroup.all(), visnDim, "Obligations by Office")};
        //var box4 = linePlot.bind(null, "#box4",weeklyGroup.all());
        function box4() {stateMap(".box4",[us], stateGroup.all())};
        //var b5a = tablePlot.bind(null, ".b5a", pscGroup.top(10), "value"), ["key","value"])
        function b5a() {tableAgPlot(".b5a", pscGroup.top(10), labels=['Product/Service','Obligations'], lu=codes, {"rowFilter":pscDim})};
        function b5b() {tableAgPlot(".b5b", vendorGroup.top(10), labels=['Contractor','Obligations'])};
        function b3() {tablePlot(".b3", colSort(dailyDim.top(Infinity), "covidAmount"), ["PIID","competed","coSizeDetermination","contractPricing","covidAmount"], 
            {"lu": colLu, "rowUrl": "k_url"});};

        var colLu = {"PIID": "Contract", 
                    "competed": "Competition", 
                    "covidAmount": "Obligations",
                    "coSizeDetermination": "Company Size",
                    "contractPricing": "Contract Pricing"};
        //const pg1 = [r1c1, r1c2, r1c3, box3];
        var pg1 = {
            ".r1c1": plotTotalObs,
            ".r1c2": r1c2,
            //".r1c3": r1c3,
            ".box3": box3,
            ".box4": box4,
            '.b5a': b5a,
            '.b5b': b5b,
            '.b3': b3
        }
            

        renderAll();

        
        

    
        //linePlot("#box3",weeklyGroup.all());
        //bubblePlot("#box3",deptGroup.all());
        //plotTreemap("#box3",deptGroup.all());


    
    </script>


</body>





</html>