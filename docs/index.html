<html>

<head>
    <!--  
        In the header:
          Add your css
          import data  

    -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>VA COVID-19 Contracting Data</title>
    
    
    <link rel="stylesheet" href="covid.css">
    



</head>

<body>
    

    <!--
        
       <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter2/1.5.2/crossfilter.min.js"></script>
        

-->



<script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>

<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script type="text/javascript" src="helpers.js"></script>
<script type="text/javascript" src="plots.js"></script>
<script type="text/javascript" src="data.json"></script>
<script type="text/javascript" src="states-albers-10m.json"></script>

    
    

    <!--
                <div class="navbar">
            <div class="button button-1">Office</div>
            <div class="button button-2">Product/<br>Service</div>
            <div class="button button-3">Start<br>Date</div>
            <div class="button button-4">End<br>Date</div>
        </div>

            <div class="row1a card"></div>
            <div class="row1b prose">VA's obligations spiked in late March/early April and have been
                relatively flat since then.</div>
            <div class="row1c"></div>

            <div class="row2text prose">Approximately two-thirds of VA's obligations were for 
                    contracts that were not competed. This is somewhat surprising given that months 
                    of the obligations were for products.
                </div>
    -->
    
    

    <div class="wrapper">
        <div class="header"><h1>COVID-19 Contracting</h1></div>

        <div class="row1"></div>

        <div class="row1a prose">VA's obligations spiked in late March/early April and have been
            relatively flat since then.</div>
       

        <div class="row2"> </div>

        <div class="row3"></div>

        <div class="row3a prose">VA has a relatively low competition rate given that the majority
            of its obligations are for products.
        </div>

        <div class="row4">
            <div class="row4menu button">Menu</div>
            <div class="row4table"></div>
        </div>
        <div class="row5"></div>

        <div id="tooltip" class="hidden"></div>

            
            
    <!-- close wrapper -->
    </div>

        <!--


    -->

    <script>

        width = 750;
        height = 600;

        var margin = {top: 20, right: 10, bottom: 20, left: 20};
        w = width-margin.left-margin.right;
        h = height-margin.top-margin.bottom;

        var months = {"01": "Jan", "02": "Feb", "03": "Mar", "04": "Apr", "05": "May", "06":"Jun"};
        var mos = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

        var sortAscending = false;

        
        var ndx = crossfilter(dataSet);
        
        
        var compDim = ndx.dimension(d=>d.competed || "NA");
        var compGroup = compDim.group().reduceSum(d=>d.obligatedAmount);

        var visnDim = ndx.dimension(d=>d.contractingofficeid || "NA");
        var visnGroup = visnDim.group().reduceSum(d=>d.obligatedAmount);

        var monthDim = ndx.dimension(d => months[d.signedDate.substr(5,2)]);
        var monthGroup = monthDim.group().reduceSum(d=>d.obligatedAmount);

        var weeklyDim = ndx.dimension(d => getMonday(d.signedDate));
        var weeklyGroup = weeklyDim.group().reduceSum(d=>d.obligatedAmount);

        var stateDim = ndx.dimension(d => d.placeOfPerformanceState);
        var stateGroup = stateDim.group().reduceSum(d=>d.obligatedAmount);

        var pvsDim = ndx.dimension(d => d.productOrService);
        var pvsGroup = pvsDim.group().reduceSum(d=>d.obligatedAmount);


        var pscDim = ndx.dimension(d => d.productOrServiceCode);
        var pscGroup = pscDim.group().reduceSum(d=>d.obligatedAmount);



        var margin = {top: 30, right: 20, bottom: 20, left: 20};

        //tableAgPlot("#box4", deptGroup.top(10), ['Department','Obligations'], orgs);
        //barPlot("#box1", deptGroup);
        
        //plotCard('.r1c1',totalobs(),'Total Obligations');



        //var r1c1 = plotCard.bind(null, ".r1c1", totalobs(), "Total Obligations");
        //function r1c1 = plotTotalObs.bind(null);
        //var r1c2 = hbarPlot.bind(null,".r1c2",reorder(monthGroup.all(), Object.values(months)),"", monthDim);
        //function row1() {plotTotalObs(".row1")}
        function row1() {barPlot(".row1", weeklyGroup.all().sort(sortWeek), "Obligations by Week", weeklyDim, {h:300})};
        function row2() {pieChart(".row2",compGroup.all(), compDim, "Competed vs Not Competed Obligations")};
        function row3() {pieChart(".row3",pvsGroup.all(), pvsDim, "Obligations for Products vs Services")};
        function row4table() {tableAgPlot(".row4table", visnGroup.top(10), labels=['Office','Obligations'], lu=orgs, {"rowFilter":visnDim})};
        function row5() {stateMap(".row5",[us], stateGroup.all())};
        //var r1c3 = pieChart.bind(null,".r1c3",compGroup.all(), compDim);
        //var box3 = bubblePlot.bind(null, "#box3",deptGroup.all());
        //function row4() {plotTreemap("#box3",visnGroup.top(10), visnDim, "Obligations by Office")};
        //var box4 = linePlot.bind(null, "#box4",weeklyGroup.all());
        //function box4() {stateMap(".box4",[us], stateGroup.all())};
        //var b5a = tablePlot.bind(null, ".b5a", pscGroup.top(10), "value"), ["key","value"])
        //function b5a() {tableAgPlot(".b5a", pscGroup.top(10), labels=['Product/Service','Obligations'], lu=codes, {"rowFilter":pscDim})};
        //function b5b() {tableAgPlot(".b5b", vendorGroup.top(10), labels=['Contractor','Obligations'])};
        //function b3() {tablePlot(".b3", colSort(dailyDim.top(Infinity), "covidAmount"), ["PIID","competed","coSizeDetermination","contractPricing","covidAmount"], 
        //    {"lu": colLu, "rowUrl": "k_url"});};

        var colLu = {"PIID": "Contract", 
                    "competed": "Competition", 
                    "covidAmount": "Obligations",
                    "coSizeDetermination": "Company Size",
                    "contractPricing": "Contract Pricing"};

        var pg1 = {
            ".row1": row1,
            ".row2": row2,
            ".row3": row3,
            ".row4table": row4table,
            ".row5": row5
        }
            

        renderAll();

        
        

    
        //linePlot("#box3",weeklyGroup.all());
        //bubblePlot("#box3",deptGroup.all());
        //plotTreemap("#box3",deptGroup.all());


    
    </script>


</body>





</html>